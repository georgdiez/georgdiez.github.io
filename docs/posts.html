<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script
        src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"
        integrity="sha256-iaFenEC8axSAnyNu6M0+0epCOTwfbKVceFXNd5s/ki4="
        crossorigin="anonymous">
    </script>
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="./nav-round.css">
    <link rel="stylesheet" href="./posts.css">
    <title>Georg Diez - Posts</title>
</head>
</head>

<body class="antialiased min-w-screen overflow-x-hidden bg-gray-50">
    <div id="nav-placeholder"></div>
    
    <div class="overlay" id="overlay"></div>
    
    <div class="min-h-screen w-full p-4 md:p-8 lg:p-12">
        <div style="max-width: 1400px; margin: 0 auto; padding: 0 2rem;">
            <div class="mb-12 text-center">
                <h1 class="text-5xl md:text-7xl font-serif text-gray-800 mb-4">Posts</h1>
            </div>

            <div id="posts-container" style="margin: 0 auto;">
            </div>
        </div>
    </div>

    <div id="copyright-footer"></div>

    <script>
        $(function(){
            $("#nav-placeholder").load("./nav.html");
            $("#copyright-footer").load("./copyright-footer.html");
            
            // Create dynamic grid based on screen width
            createDynamicGrid();
        });

        function createDynamicGrid() {
            const container = document.getElementById('posts-container');
            const posts = [
                {
                    id: 1,
                    image: "img/defense.JPG",
                    imageX: 50, 
                    imageY: 10,
                    alt: "Defense Celebration",
                    date: "January 9, 2025",
                    readTime: "2 min read",
                    title: "Dr. Diez!",
                    excerpt: "On September 9th, 2025, I successfully defended my PhD thesis!",
                    isPortrait: true,
                    fullContent: `<p>After roughly four years of research and countless cups of coffee (classic PhD humor, I know), 
                        I'm thrilled to announce that I successfully defended my PhD thesis on September 9th, 2025!</p>
                        <p>My committee consisted of Prof. Gerhard Stock, Prof. Günter Reiter and Prof. Joachim Dzubiella.
                        You can find my thesis <a href="https://freidok.uni-freiburg.de/data/271694" class="text-blue-700 hover:text-blue-300">here</a>.</p>
                        <p>I am extremely grateful and happy for all the support I have received during this journey,
                        especially from my supervisor Gerhard, who somehow managed to keep me on track and had 
                        a lot of patience during my more ambitious research ideas,
                        and my dear colleagues on the 10th floor of the Physics high-rise
                        (also for preparing this awesome doctoral hat).
                        Huge thanks to the friends and family who showed up and supported me on this special day. 
                        Afterwards we enjoyed nice finger food and drinks on the rooftop.</p>
                        <img src="img/defense2.JPG" alt="Celebration afterwards" style="width: 100%; max-width: 800px; height: auto; margin: 1.5rem auto; display: block; border-radius: 8px;">
                        `
                },
                {
                    id: 2,
                    image: "img/defense.JPG",
                    imageX: 50, 
                    imageY: 10, 
                    alt: "Defense Celebration",
                    date: "January 15, 2024",
                    readTime: "2 min read",
                    title: "PhD Defense Done!",
                    excerpt: "On September 9th, 2025, I successfully defended my PhD thesis!",
                    isPortrait: false,
                    fullContent: `
                        <p>After years of research, countless experiments, and many late nights in the lab, 
                        I'm thrilled to announce that I successfully defended my PhD thesis on September 9th, 2025!</p>
                        <p>The defense was both challenging and rewarding, with great questions from the committee 
                        that really pushed me to think deeply about my research contributions.</p>
                        <p>This journey has taught me so much about persistence, critical thinking, and the 
                        importance of collaboration in scientific research.</p>`
                },
                {
                    id: 3,
                    image: "img/defense.JPG",
                    imageX: 50, // X position in percentage (0-100)
                    imageY: 10, // Y position in percentage (0-100) - 20% from top to focus on upper part
                    alt: "Defense Celebration",
                    date: "January 15, 2024",
                    readTime: "2 min read",
                    title: "PhD Defense Done!",
                    excerpt: "On September 9th, 2025, I successfully defended my PhD thesis!",
                    isPortrait: true,
                    fullContent: `
                        <p>nothing here yet</p>`
                },
            ];

            // Calculate optimal layout
            const layout = calculateOptimalLayout(posts.length);
            console.log("=== DYNAMIC GRID DEBUG ===");
            console.log("Screen width:", window.innerWidth);
            console.log("Container width:", layout.containerWidth);
            console.log("Columns:", layout.columns);
            console.log("Card width:", layout.cardWidth);
            console.log("Gap:", layout.gap);

            // Create grid container with calculated dimensions
            container.style.width = layout.containerWidth + 'px';
            container.style.display = 'grid';
            container.style.gridTemplateColumns = `repeat(${layout.columns}, ${layout.cardWidth}px)`;
            container.style.gap = layout.gap + 'px';
            container.style.gridTemplateRows = 'auto';

            // Clear any existing content
            container.innerHTML = '';

            // Create and position cards
            posts.forEach((post, index) => {
                const cardElement = createPostCard(post);
                
                // Calculate position
                const row = Math.floor(index / layout.columns) + 1;
                const col = (index % layout.columns) + 1;
                
                // Explicitly set grid position
                cardElement.style.gridColumn = col;
                cardElement.style.gridRow = row;
                
                console.log(`Card ${post.id}: Row ${row}, Column ${col}`);
                
                container.appendChild(cardElement);
            });
        }

        function calculateOptimalLayout(numPosts) {
            const screenWidth = window.innerWidth;
            const maxContainerWidth = Math.min(screenWidth - 100, 1400); // Leave some margin
            
            let columns, cardWidth, gap, containerWidth;
            
            if (screenWidth >= 1200) {
                // Large screens: Try to fit 3 columns
                columns = Math.min(3, numPosts);
                gap = 32;
                cardWidth = Math.floor((maxContainerWidth - (gap * (columns - 1))) / columns);
                containerWidth = (cardWidth * columns) + (gap * (columns - 1));
            } else if (screenWidth >= 768) {
                // Medium screens: 2 columns
                columns = Math.min(2, numPosts);
                gap = 24;
                cardWidth = Math.floor((maxContainerWidth - (gap * (columns - 1))) / columns);
                containerWidth = (cardWidth * columns) + (gap * (columns - 1));
            } else {
                // Small screens: 1 column
                columns = 1;
                gap = 16;
                cardWidth = Math.min(400, maxContainerWidth);
                containerWidth = cardWidth;
            }
            
            return { columns, cardWidth, gap, containerWidth };
        }

        function createPostCard(post) {
            const article = document.createElement('article');
            article.className = 'post-card';
            article.setAttribute('data-post', post.id);
            article.style.height = '510px';
            
            // Set object-position based on imageX and imageY parameters
            const imageX = post.imageX !== undefined ? post.imageX : 50; // Default to center (50%)
            const imageY = post.imageY !== undefined ? post.imageY : 50; // Default to center (50%)
            const objectPosition = `${imageX}% ${imageY}%`;
            
            article.innerHTML = `
                <img src="${post.image}" 
                     alt="${post.alt}" 
                     class="post-image"
                     style="object-position: ${objectPosition};">
                <div class="post-content">
                    <button class="close-btn" onclick="closePost(event)">&times;</button>
                    <div>
                        <div class="post-meta">${post.date} • ${post.readTime}</div>
                        <h2 class="post-title">${post.title}</h2>
                        <div class="post-excerpt">
                            <p>${post.excerpt}</p>
                        </div>
                    </div>
                    <div class="post-card-footer">
                        <a href="#" class="read-more" onclick="expandPost(event, ${post.id}, ${post.isPortrait || false})">Read more →</a>
                    </div>
                    <div class="post-full-content">
                        ${post.fullContent}
                    </div>
                </div>
            `;
            
            return article;
        }

        // Recalculate layout on window resize
        window.addEventListener('resize', function() {
            createDynamicGrid();
        });

        function expandPost(event, postId, isPortrait = false) {
            event.preventDefault();
            event.stopPropagation();
            
            const postCard = document.querySelector(`[data-post="${postId}"]`);
            const overlay = document.getElementById('overlay');
            
            // Add expanded class
            postCard.classList.add('expanded');
            
            // Add portrait layout class if specified
            if (isPortrait) {
                postCard.classList.add('portrait-layout');
            }
            
            overlay.classList.add('active');
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
            
            // Scroll to top of expanded post
            postCard.scrollTop = 0;
        }

        function closePost(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const postCard = event.target.closest('.post-card');
            const overlay = document.getElementById('overlay');
            
            // Remove expanded and portrait-layout classes
            postCard.classList.remove('expanded', 'portrait-layout');
            overlay.classList.remove('active');
            
            // Restore body scroll
            document.body.style.overflow = 'auto';
        }

        // Close post when clicking overlay
        document.getElementById('overlay').addEventListener('click', function() {
            const expandedPost = document.querySelector('.post-card.expanded');
            if (expandedPost) {
                closePost({ target: expandedPost, preventDefault: () => {}, stopPropagation: () => {} });
            }
        });

        // Close post with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const expandedPost = document.querySelector('.post-card.expanded');
                if (expandedPost) {
                    closePost({ target: expandedPost, preventDefault: () => {}, stopPropagation: () => {} });
                }
            }
        });

        // Prevent clicks inside expanded post from closing it
        document.addEventListener('click', function(event) {
            const expandedPost = document.querySelector('.post-card.expanded');
            if (expandedPost && !expandedPost.contains(event.target) && !event.target.classList.contains('overlay')) {
                return;
            }
        });
    </script>
</body>
</html>